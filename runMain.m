%复现论文10.1109/ACCESS.2016.2587581 作者Srivastava Madhur, Anderson C. Lindsay
%代码作者：陈羿乔 Yiqiao Chen
%日期：2024/4/23

%复现效果不好

clc; clear; close all;
format compact; %命令行显示不换行

%==========================================================================
%-----------------------------常量设置与文件导入-----------------------------
%==========================================================================

%读取PPG文件
file1 = readmatrix("755.csv");
file1 = file1(1:length(file1),1);
rowPpg1 = cat(1, zeros(2^14 - length(file1), 1), file1); %补零延拓为2幂次的数据
clear file1;

%==========================================================================
%---------------------------------第一次拆分--------------------------------
%==========================================================================

[k, cD, cD_L, cD_H, Sj, Sj_L, Sj_H, Sr_L, Sr_H] = first_dec(rowPpg1);

%==========================================================================
%---------------------------------第二次拆分--------------------------------
%==========================================================================

[new_C, L, lambda_L, lambda_H] = second_dec(k, cD, cD_L, cD_H, Sj, Sj_L, Sj_H, Sr_L, Sr_H, rowPpg1);

%==========================================================================
%---------------------------消失矩为4的多贝西平稳小波重构--------------------
%==========================================================================

denoisiedPpg1 = waverec(new_C, L, "fk8");
figure(1);
plot(rowPpg1, "b");

grid on;
hold on;

plot(denoisiedPpg1, "r");

hold off;
legend("RowPPG", "FilteredPPG")